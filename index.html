<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Text Extractor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Vue 2 + Vuetify + Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.7.1/dist/vuetify.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.7.1/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/styles.css">

    <!-- Tesseract.js CDN (exposed globally) -->
    <script src="https://unpkg.com/tesseract.js@v2.0.2/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.min.js"></script>
</head>

<body>

    <div id="app" v-cloak class="container mt-2 flex min-h-screen border">
        <!-- Vue template content -->
        <div class="container">
            <h1 class="mb-2 p-3 rounded text-center main-title">Text Extractor and Formatter</h1>
            <div class="col-12 col-sm-9 col-md-10 col-lg-11">
                <!-- Tabs -->
                <!-- https://jigsaw.w3.org/css-validator/#validate_by_uri FIXED Vuetify Tabs Structure -->
                <v-tabs id="selected" v-model="selectedTab" color="secondary" :active-class="'tabs-active'">
                    <v-tab v-for="item in tabItems" :key="item">{{item}}</v-tab>
                </v-tabs>
                <v-tabs-items v-model="selectedTab">
                    <!-- Direct Input -->
                    <v-tab-item key="direct">
                        <v-form validate-on="submit lazy" v-on:submit.prevent="submit">
                            <v-card class="p-2">
                                <h3 id="DirectLabel" for="inputDirect" class=" p-2">Input:
                                </h3>
                                <div class="inputArea">

                                    <!-- Component for file list -->


                                    <v-textarea id="inputDirect" v-model="noteText" aria-label="direct Input Area" type="text" class="form-control mb-0" rows="5" placeholder="Bingle Bangle Lippity Too Lippity Tad"></v-textarea>
                                    <div class="d-flex justify-content-center gap-2 my-2 btnFeast">
                                        <file-list :files="sampleFiles" @file-clicked="fetchExternalFile"></file-list>
                                    </div>

                                    <!--That is a weird -->
                                    <div class="d-flex justify-content-center gap-2 my-2 ">
                                        <button type="button" :disabled="isProcessing" @click="formatText" aria-label="Submit text for formatting" class="btn btn-primary flex-grow-1"> Submit </button>
                                        <button type="button" :disabled="isProcessing" @click="resetAfterError" aria-label="Clear input for formatting" class="btn btn-secondary flex-grow-1"> Clear  </button>
                                    </div>
                                    <div v-if="alertMessage" class="alert alert-danger fw-4  mb-2" role="alert" aria-live="assertive"> {{ alertMessage }} </div>

                                </div>
                            </v-card>
                            <!--Progress Bar V1 with dynamic Updating-->
                            <div v-if="loading" class="rounded py-2 px-4 load-bar">
                                <div class="progress mt-2 mb-2" min="0" max="100">
                                    <div class="progress-bar" :style="{ width: progressValue + '%' }">
                                        {{ progressValue }}%
                                    </div>
                                </div>
                            </div>
                        </v-form>
                    </v-tab-item>
                    <!-- File Upload -->
                    <v-tab-item key="upload">
                        <v-form validate-on="submit lazy" v-on:submit.prevent="submit">
                            <v-card class=" p-2 mb-0 input-card">
                                <div class="uploadFile px-2 rounded">
                                    <label id="uploadLabel" for="uploadLabel" class="display-6 p-2">Input:</label>
                                    <!-- File Upload Input -->
                                    <v-file-input v-model="pdfFile" label="Upload PDF / Image" aria-label="Upload PDF, Image, or TXT file" accept=".pdf,.png,.jpg,.jpeg,.txt" dense></v-file-input>

                                </div>
                                <div class="d-flex mt-2 gap-1">
                                    <v-btn @click="processFile" class="px-2 flex-grow" aria-label="Extract text from PDF only" :disabled="!pdfFile || pdfFile.type !=='application/pdf'">Extract PDF</v-btn>
                                    <v-btn @click="processFileImage" class="px-2 flex-grow" aria-label="Extract text from images or other files" :disabled="!pdfFile">Extract Image/TXT</v-btn>
                                    <v-btn @click="resetAfterError" class="flex-grow" aria-label="Clear input" :disabled="isProcessing">Clear</v-btn>
                                </div>
                                <div v-if="loading" class="rounded py-2 px-4 load-bar">
                                    <div class="progress mt-2 mb-2" min="0" max="100">
                                        <div class="progress-bar" :style="{ width: progressValue + '%' }">
                                            {{ progressValue }}%
                                        </div>
                                    </div>
                                </div>
                            </v-card>
                        </v-form>
                    </v-tab-item>
                </v-tabs-items>

                <!-- Output Pages -->
                <v-card v-if="pages.length" class="mt-3 p-2  mx-2">
                    <h3>Output</h3>
                    <div v-html="currentPage" class="mx-2"></div>
                    <!---Pagination-->
                    <div class="d-flex justify-content-center mt-2">
                        <v-btn @click="prevPage" :disabled="currentPageIndex===0">← Prev</v-btn>
                        <span class="mx-2">Page {{currentPageIndex+1}} / {{pages.length}}</span>
                        <v-btn @click="nextPage" :disabled="currentPageIndex===pages.length-1">Next →</v-btn>
                    </div>
                </v-card>

                <!-- Keywords -->
                <div v-if="keywords.length" class="card 0-4 mx-2 mt-2">
                    <h5>Keywords:</h5>
                    <ul class="d-flex flex-wrap list-unstyled mt-2">
                        <li class="mx-3 mb-2" v-for="(word, index) in keywords" :key="index"> • {{ word }} </li>
                    </ul>
                </div>

            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="js/components/filters.js"></script>
    <!-- UNDER NO CIRCUMSTANCES SHOULD THIS BE AFTER APP.JS ITS A GLOBAL -->
    <!-- Main Vue module -->
    <script type="module" src="js/app.js"></script>
</body>

</html>